<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes"/>
    <meta name="description" content="AgriConnectHub- Empowering Agriculture Through Technology."/>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://generativelanguage.googleapis.com https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com; font-src 'self' https://cdnjs.cloudflare.com https://fonts.googleapis.com https://fonts.gstatic.com; img-src 'self' data: https:; connect-src 'self' https://generativelanguage.googleapis.com;"/>
    <title>AI ChatBot - AgriConnectHub</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
    
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="main.css" />
    <link rel="stylesheet" href="theme.css" />
    <link rel="stylesheet" href="chat.css" />
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
    
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
      .uniform-header { background: linear-gradient(135deg, #16a34a 0%, #22c55e 100%); box-shadow: 0 6px 20px rgba(22, 163, 74, 0.25); display: flex; justify-content: space-between; align-items: center; padding: 1rem 2rem; height: 80px; }
      .brand h2 { color: white; margin: 0; font-size: 1.6rem; }
      .header-buttons { display: flex; gap: 1rem; align-items: center; }
      .header-buttons a, .header-buttons button { background: rgba(255,255,255,0.15); color: white; padding: 0.6rem 1.2rem; border-radius: 8px; border: 1px solid rgba(255,255,255,0.2); transition: all 0.3s; cursor: pointer; text-decoration: none; font-weight: 500; }
      .header-buttons a:hover, .header-buttons button:hover { background: rgba(255,255,255,0.25); transform: translateY(-2px); }
      .site-footer { background: linear-gradient(135deg, #2e7d32, #66bb6a); color: #fff; margin-top: auto; padding: 1.5rem; text-align: center; font-size: 0.9rem; width: 100%; display: flex; justify-content: center; align-items: center; }
      .site-footer p { margin: 0; text-align: center; }
      .site-footer a { color: #fff; text-decoration: none; }
      .site-footer a:hover { text-decoration: underline; }
      .chat-header h2 { color: var(--light-green); }
      .logo h1 { color: var(--light-green); }
    </style>
  </head>
  <body>
    <div class="header-nav-wrapper">
      <header class="uniform-header">
        <div class="brand"><h2>ðŸŒ¾ AgriConnectHub Dashboard</h2></div>
        <div class="header-buttons">
          <a href="cropCalendar.html" class="calendar-button" title="Crop Calendar"><span class="calendar-icon">ðŸ“…</span>Calendar</a>
          <a href="feed-back.html" class="feedback-button">ðŸ’¬ Feedback</a>
          <a href="#" class="logout-button" onclick="showLogoutConfirmation()">ðŸšª Logout</a>
          <button class="theme-toggle" aria-label="Toggle dark/light mode">
            <i class="fas fa-sun sun-icon"></i>
            <i class="fas fa-moon moon-icon"></i>
            <span class="theme-text">Light</span>
          </button>
        </div>
      </header>
    </div>

    <main>
      <div id="chat-container">
        <div class="chat-header">
          <i class="fas fa-robot"></i>
          <h2>Ask me anything about agriculture, crops, or farming techniques</h2>
        </div>

        <div id="chat-window">
          <div class="welcome-message">
            <h3><i class="fas fa-leaf"></i> Welcome to AgriConnectHub Assistant!</h3>
            <p>I'm powered by Google Gemini AI to help with all your farming questions.</p>

            <div class="suggestions">
              <div class="suggestion">Best crops for this season?</div>
              <div class="suggestion">Organic pest control methods</div>
              <div class="suggestion">Water conservation techniques</div>
              <div class="suggestion">Soil health improvement</div>
            </div>
          </div>
        </div>

        <form id="chat-form">
          <div class="input-container">
            <input type="text" id="chat-input" placeholder="Ask about crops, weather, fertilizers..." aria-label="Chat input" autofocus required/>
          </div>
          <button type="submit" id="send-button">
            <i class="fas fa-paper-plane"></i> Send
          </button>
        </form>
      </div>
    </main>

    <footer class="site-footer">
      <p>&copy; 2025 Rural-IT-Hub. All rights reserved. powered by technoble.solutions. Email: <a href="mailto:admin@ruralithub.net">admin@ruralithub.net</a></p>
    </footer>

    <script src="chat.js"></script>
    <script src="nav.js"></script>
    <script src="auth.js"></script>
    <script src="theme.js"></script>
    
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        if (!window.authManager.isLoggedIn()) {
          window.location.href = '/login';
          return;
        }

        const currentUser = window.authManager.getCurrentUser();
        if (currentUser) {
          const headerTitle = document.querySelector('header h2');
          if (headerTitle) {
            headerTitle.textContent = `Welcome to AgriConnectHub, ${currentUser.fullname}!`;
          }
        }
      });

      function showLogoutConfirmation() {
        Swal.fire({
          title: 'Confirm Logout',
          text: 'Are you sure you want to logout?',
          icon: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#d33',
          cancelButtonColor: '#3085d6',
          confirmButtonText: 'Yes, logout',
          cancelButtonText: 'Cancel'
        }).then((result) => {
          if (result.isConfirmed) {
            const logoutResult = window.authManager.logout();
            if (logoutResult.success) {
              Swal.fire({
                title: 'Logged Out!',
                text: logoutResult.message,
                icon: 'success',
                timer: 2000,
                showConfirmButton: false
              }).then(() => {
                window.location.href = '/';
              });
            } else {
              Swal.fire({
                title: 'Error!',
                text: logoutResult.message,
                icon: 'error'
              });
            }
          }
        });
      }
    </script>
  </body>
</html>
