<!DOCTYPE html>
<html lang="te">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>‡∞™‡∞Ç‡∞ü ‡∞ß‡∞∞ ‡∞ü‡±ç‡∞∞‡∞æ‡∞ï‡∞∞‡±ç - AgriConnectHub</title>
  <link rel="stylesheet" href="{{ url_for('crop_price_tracker.static', filename='styles.css') }}">
  <link rel="stylesheet" href="../../theme.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>
<body>
  <div class="header-nav-wrapper">
    <header class="uniform-header">
      <div class="brand">
        <h2>AgriConnectHub ‡∞ï‡±Å ‡∞∏‡±ç‡∞µ‡∞æ‡∞ó‡∞§‡∞Ç</h2>
      </div>
      <div class="header-buttons">
        <a href="../../../cropCalendar.html" class="calendar-button" title="‡∞™‡∞Ç‡∞ü ‡∞ï‡±ç‡∞Ø‡∞æ‡∞≤‡±Ü‡∞Ç‡∞°‡∞∞‡±ç">
          <span class="calendar-icon">üìÖ</span> ‡∞ï‡±ç‡∞Ø‡∞æ‡∞≤‡±Ü‡∞Ç‡∞°‡∞∞‡±ç
        </a>
        <a href="../../../feed-back.html" class="feedback-button">‡∞´‡±Ä‡∞°‡±ç‚Äå‡∞¨‡±ç‡∞Ø‡∞æ‡∞ï‡±ç</a>
        <a href="#" class="logout-button" onclick="showLogoutConfirmation()">‡∞≤‡∞æ‡∞ó‡±ç ‡∞Ö‡∞µ‡±Å‡∞ü‡±ç</a>
        <button class="theme-toggle" aria-label="‡∞°‡∞æ‡∞∞‡±ç‡∞ï‡±ç/‡∞≤‡±à‡∞ü‡±ç ‡∞Æ‡±ã‡∞°‡±ç ‡∞Æ‡∞æ‡∞∞‡±ç‡∞ö‡∞Ç‡∞°‡∞ø">
          <i class="fas fa-sun sun-icon"></i>
          <i class="fas fa-m‡±Ç‡∞®‡±ç ‡∞Æ‡±Ç‡∞®‡±ç-‡∞ê‡∞ï‡∞æ‡∞®‡±ç"></i>
          <span class="theme-text">‡∞≤‡±à‡∞ü‡±ç</span>
        </button>
      </div>
    </header>

    
  </div>

  <div class="page-header" style="max-width: 1200px; margin: 30px auto 20px auto; padding: 0 20px;">
    <h1><i class="fas fa-chart-line"></i> ‡∞™‡∞Ç‡∞ü ‡∞ß‡∞∞ ‡∞ü‡±ç‡∞∞‡∞æ‡∞ï‡∞∞‡±ç</h1>
    <p>‡∞≠‡∞æ‡∞∞‡∞§‡∞¶‡±á‡∞∂‡∞Ç‡∞≤‡±ã‡∞®‡∞ø ‡∞Æ‡∞æ‡∞∞‡±ç‡∞ï‡±Ü‡∞ü‡±ç‡∞≤‡∞≤‡±ã ‡∞∞‡∞ø‡∞Ø‡∞≤‡±ç-‡∞ü‡±à‡∞Æ‡±ç ‡∞™‡∞Ç‡∞ü ‡∞ß‡∞∞‡∞≤‡∞®‡±Å ‡∞ü‡±ç‡∞∞‡∞æ‡∞ï‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø</p>
  </div>

  <main class="form-container" style="max-width: 1200px; margin: 0 auto 40px auto; padding: 20px;">
    <form method="POST" action="/crop_price_tracker/track_prices" id="priceForm" class="price-form" style="width: 100%; display: flex; gap: 20px; flex-wrap: wrap; align-items: flex-end; justify-content: flex-start;">
      <div class="form-row" style="flex: 1 1 20%; min-width: 180px;">
        <label for="crop" class="form-label"><i class="fas fa-seedling"></i> ‡∞™‡∞Ç‡∞ü‡∞®‡±Å ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø</label>
        <select name="crop" id="crop" required>
          <option value="">-- ‡∞™‡∞Ç‡∞ü ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø --</option>
          {% for crop in crops %}
          <option value="{{ crop }}" {% if crop == request.form.get('crop') %}selected{% endif %}>{{ crop }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="form-row" style="flex: 1 1 20%; min-width: 180px;">
        <label for="state" class="form-label"><i class="fas fa-map-marker-alt"></i> ‡∞∞‡∞æ‡∞∑‡±ç‡∞ü‡±ç‡∞∞‡∞Ç ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø</label>
        <select name="state" id="state" required {% if not request.form.get('state') %}disabled{% endif %}>
          <option value="">-- ‡∞∞‡∞æ‡∞∑‡±ç‡∞ü‡±ç‡∞∞‡∞Ç ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø --</option>
          {% if request.form.get('state') %}
          <option value="{{ request.form.get('state') }}" selected>{{ request.form.get('state') }}</option>
          {% endif %}
        </select>
      </div>

      <div class="form-row" style="flex: 1 1 20%; min-width: 180px;">
        <label for="market" class="form-label"><i class="fas fa-store"></i> ‡∞Æ‡∞æ‡∞∞‡±ç‡∞ï‡±Ü‡∞ü‡±ç ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø</label>
        <select name="market" id="market" required {% if not request.form.get('market') %}disabled{% endif %}>
          <option value="">-- ‡∞Æ‡∞æ‡∞∞‡±ç‡∞ï‡±Ü‡∞ü‡±ç ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø --</option>
          {% if request.form.get('market') %}
          <option value="{{ request.form.get('market') }}" selected>{{ request.form.get('market') }}</option>
          {% endif %}
        </select>
      </div>

      <div class="form-row" style="flex: 1 1 20%; min-width: 180px; display: flex; gap: 15px; margin-top: 0;">
        <button type="submit" class="submit-button" id="submitBtn" disabled" style="flex: 1;">
          <i class="fas fa-chart-line"></i> ‡∞ß‡∞∞‡∞≤‡∞®‡±Å ‡∞ü‡±ç‡∞∞‡∞æ‡∞ï‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø
        </button>
        <button type="reset" class="submit-button" id="resetBtn" style="background: #388e3c; flex: 1;">
          <i class="fas fa-times"></i> ‡∞ï‡±ç‡∞≤‡∞ø‡∞Ø‡∞∞‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø
        </button>
      </div>
    </form>
  </main>

  <section class="form-container" style="max-width: 1200px; margin: 0 auto 40px auto; padding: 20px;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
      <h3><i class="fas fa-list"></i> ‡∞ß‡∞∞ ‡∞´‡∞≤‡∞ø‡∞§‡∞æ‡∞≤‡±Å</h3>
      <div style="display: flex; gap: 10px;">
        <button class="submit-button" style="padding: 8px 15px; font-size: 0.9em;">‡∞ß‡∞∞ ‡∞Ü‡∞ß‡∞æ‡∞∞‡∞Ç‡∞ó‡∞æ ‡∞∏‡∞æ‡∞∞‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø</button>
        <button class="submit-button" style="padding: 8px 15px; font-size: 0.9em;">‡∞§‡±á‡∞¶‡±Ä ‡∞Ü‡∞ß‡∞æ‡∞∞‡∞Ç‡∞ó‡∞æ ‡∞∏‡∞æ‡∞∞‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø</button>
      </div>
    </div>

    <table class="results-table" style="width: 100%; border-collapse: collapse;" aria-live="polite" aria-atomic="true">
      <thead style="background: #2e7d32; color: white;">
        <tr>
          <th style="padding: 12px 15px; text-align: left;">‡∞§‡±á‡∞¶‡±Ä</th>
          <th style="padding: 12px 15px; text-align: left;">‡∞Æ‡∞æ‡∞∞‡±ç‡∞ï‡±Ü‡∞ü‡±ç</th>
          <th style="padding: 12px 15px; text-align: left;">‡∞∞‡∞æ‡∞∑‡±ç‡∞ü‡±ç‡∞∞‡∞Ç</th>
          <th style="padding: 12px 15px; text-align: right;">‡∞ß‡∞∞ (‚Çπ/‡∞ï‡±ç‡∞µ‡∞ø‡∞Ç‡∞ü‡∞æ‡∞≤‡±ç)</th>
          <th style="padding: 12px 15px; text-align: center;">‡∞ö‡∞∞‡±ç‡∞Ø‡∞≤‡±Å</th>
        </tr>
      </thead>
      <tbody>
        {% for row in result %}
        <tr style="border-bottom: 1px solid #ddd;">
          <td style="padding: 10px 15px;">{{ row['arrival_date'] }}</td>
          <td style="padding: 10px 15px;">{{ row['market'] }}</td>
          <td style="padding: 10px 15px;">{{ row['state'] }}</td>
          <td style="padding: 10px 15px; text-align: right; color: #388e3c; font-weight: 700;">‚Çπ{{ row['modal_price'] }}</td>
          <td style="padding: 10px 15px; text-align: center;">
            <button class="submit-button" style="background: transparent; box-shadow: none; color: #2e7d32; font-size: 1.2em; cursor: pointer;">
              <i class="fas fa-star"></i>
            </button>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </section>

  <footer style="background: #2e7d32; color: white; text-align: center; padding: 20px 10px; font-size: 0.9em;">
    ¬© 2024 AgriTech Crop Price Tracker. Data.gov.in ‡∞Ü‡∞ß‡∞æ‡∞∞‡∞Ç‡∞ó‡∞æ
  </footer>

  <script>
    const cropSelect = document.getElementById("crop");
    const stateSelect = document.getElementById("state");
    const marketSelect = document.getElementById("market");
    const submitBtn = document.getElementById("submitBtn");

    function updateSubmitButton() {
      const isFormComplete =
        cropSelect.value && stateSelect.value && marketSelect.value;
      submitBtn.disabled = !isFormComplete;
    }

    cropSelect.addEventListener("change", function () {
      const loadingText = "‡∞∞‡∞æ‡∞∑‡±ç‡∞ü‡±ç‡∞∞‡∞æ‡∞≤‡±Å ‡∞≤‡±ã‡∞°‡±ç ‡∞Ö‡∞µ‡±Å‡∞§‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞Ø‡∞ø...";
      stateSelect.innerHTML = `<option value="">${loadingText}</option>`;
      stateSelect.disabled = true;
      stateSelect.classList.add("loading");

      fetch("/crop_price_tracker/get_states?crop=" + this.value)
        .then((res) => res.json())
        .then((states) => {
          stateSelect.innerHTML = '<option value="">-- ‡∞∞‡∞æ‡∞∑‡±ç‡∞ü‡±ç‡∞∞‡∞Ç ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø --</option>';
          states.forEach((state) => {
            stateSelect.innerHTML += `<option value="${state}">${state}</option>`;
          });
          stateSelect.disabled = false;
          stateSelect.classList.remove("loading");

          marketSelect.innerHTML = '<option value="">-- ‡∞Æ‡∞æ‡∞∞‡±ç‡∞ï‡±Ü‡∞ü‡±ç ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø --</option>';
          marketSelect.disabled = true;
          updateSubmitButton();
        })
        .catch((error) => {
          console.error("‡∞∞‡∞æ‡∞∑‡±ç‡∞ü‡±ç‡∞∞‡∞æ‡∞≤‡±Å ‡∞≤‡±ã‡∞°‡±ç ‡∞≤‡±ã ‡∞≤‡±ã‡∞™‡∞Ç:", error);
          stateSelect.innerHTML = '<option value="">-- ‡∞∞‡∞æ‡∞∑‡±ç‡∞ü‡±ç‡∞∞‡∞æ‡∞≤‡±Å ‡∞≤‡±ã‡∞°‡±ç ‡∞≤‡±ã ‡∞≤‡±ã‡∞™‡∞Ç --</option>';
          stateSelect.classList.remove("loading");
        });
    });

    stateSelect.addEventListener("change", function () {
      const crop = cropSelect.value;
      const state = this.value;

      if (state) {
        const loadingText = "‡∞Æ‡∞æ‡∞∞‡±ç‡∞ï‡±Ü‡∞ü‡±ç‡∞≤‡±Å ‡∞≤‡±ã‡∞°‡±ç ‡∞Ö‡∞µ‡±Å‡∞§‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞Ø‡∞ø...";
        marketSelect.innerHTML = `<option value="">${loadingText}</option>`;
        marketSelect.disabled = true;
        marketSelect.classList.add("loading");

        fetch(`/crop_price_tracker/get_markets?crop=${crop}&state=${state}`)
          .then((res) => res.json())
          .then((markets) => {
            marketSelect.innerHTML = '<option value="">-- ‡∞Æ‡∞æ‡∞∞‡±ç‡∞ï‡±Ü‡∞ü‡±ç ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø --</option>';
            markets.forEach((market) => {
              marketSelect.innerHTML += `<option value="${market}">${market}</option>`;
            });
            marketSelect.disabled = false;
            marketSelect.classList.remove("loading");
            updateSubmitButton();
          })
          .catch((error) => {
            console.error("‡∞Æ‡∞æ‡∞∞‡±ç‡∞ï‡±Ü‡∞ü‡±ç‡∞≤‡±Å ‡∞≤‡±ã‡∞°‡±ç ‡∞≤‡±ã ‡∞≤‡±ã‡∞™‡∞Ç:", error);
            marketSelect.innerHTML = '<option value="">-- ‡∞Æ‡∞æ‡∞∞‡±ç‡∞ï‡±Ü‡∞ü‡±ç‡∞≤‡±Å ‡∞≤‡±ã‡∞°‡±ç ‡∞≤‡±ã ‡∞≤‡±ã‡∞™‡∞Ç --</option>';
            marketSelect.classList.remove("loading");
          });
      } else {
        marketSelect.innerHTML = '<option value="">-- ‡∞Æ‡∞æ‡∞∞‡±ç‡∞ï‡±Ü‡∞ü‡±ç ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø --</option>';
        marketSelect.disabled = true;
        updateSubmitButton();
      }
    });

    marketSelect.addEventListener("change", updateSubmitButton);

    document.getElementById("priceForm").addEventListener("submit", function () {
      submitBtn.classList.add("loading");
      submitBtn.textContent = "‡∞ß‡∞∞‡∞≤‡±Å ‡∞™‡±ä‡∞Ç‡∞¶‡±Å‡∞§‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞Ç...";
    });

    updateSubmitButton();
  </script>

  <script src="../../nav.js"></script>
  <script src="../../auth.js"></script>
  <script src="../../theme.js"></script>
      <script>
    // Shared Footer Loader
    document.addEventListener('DOMContentLoaded', function() {
      // Create footer if it doesn't exist
      if (!document.querySelector('.site-footer')) {
        const footerHTML = `
          <style>
            .site-footer {
              background: linear-gradient(135deg, #2e7d32, #66bb6a);
              color: #fff;
              margin-top: auto;
              padding: 1.5rem;
              text-align: center;
              font-size: 0.9rem;
              width: 100%;
              display: flex;
              justify-content: center;
              align-items: center;
            }
            .site-footer p {
              margin: 0;
              text-align: center;
            }
            .site-footer a {
              color: #fff;
              text-decoration: none;
            }
            .site-footer a:hover {
              text-decoration: underline;
            }
          </style>
          <footer class="site-footer">

          </footer>
        `;
        
        // Insert footer before closing body tag
        document.body.insertAdjacentHTML('beforeend', footerHTML);
      }
    });
  </script>
</body>
</html>

