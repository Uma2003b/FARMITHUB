<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes"/>
    <meta name="description" content="AgriConnectHub- Empowering Agriculture Through Technology."/>
    <title>Crop Planning AI - AgriConnectHub</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
    
    <link rel="stylesheet" href="../../style.css" />
    <link rel="stylesheet" href="../../main.css" />
    <link rel="stylesheet" href="../../theme.css" />
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        .uniform-header { background: linear-gradient(135deg, #16a34a 0%, #22c55e 100%); box-shadow: 0 6px 20px rgba(22, 163, 74, 0.25); display: flex; justify-content: space-between; align-items: center; padding: 1rem 2rem; height: 80px; }
        .brand h2 { color: white; margin: 0; font-size: 1.6rem; }
        .header-buttons { display: flex; gap: 1rem; align-items: center; }
        .header-buttons a, .header-buttons button { background: rgba(255,255,255,0.15); color: white; padding: 0.6rem 1.2rem; border-radius: 8px; border: 1px solid rgba(255,255,255,0.2); transition: all 0.3s; cursor: pointer; text-decoration: none; font-weight: 500; }
    .apps-dropdown { position: relative; }
    .apps-btn { background: rgba(255,255,255,0.15); color: white; padding: 0.6rem 1.2rem; border-radius: 8px; border: 1px solid rgba(255,255,255,0.2); cursor: pointer; font-size: 0.9rem; display: flex; align-items: center; gap: 0.5rem; transition: all 0.3s; font-weight: 500; }
    .apps-btn:hover { background: rgba(255,255,255,0.25); transform: translateY(-2px); }
    .dropdown-menu { position: fixed; top: 85px; right: 2rem; background: white; border-radius: 8px; box-shadow: 0 8px 24px rgba(0,0,0,0.2); min-width: 300px; max-height: 450px; overflow-y: auto; z-index: 1005; display: none; }
    .dropdown-menu.show { display: block; }
    .dropdown-menu a { display: flex; align-items: center; gap: 0.8rem; padding: 0.8rem 1rem; color: #333; text-decoration: none; transition: all 0.2s; border-bottom: 1px solid #f0f0f0; }
    .dropdown-menu a:hover { background: #f5f5f5; padding-left: 1.2rem; }
    .dropdown-menu a span { font-size: 1.2rem; min-width: 1.5rem; }
    .dropdown-category { padding: 0.8rem 1rem; font-weight: 600; font-size: 0.8rem; color: #666; text-transform: uppercase; background: #f9f9f9; border-bottom: 1px solid #e0e0e0; }

        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #e8f5e8, #f1f8e9); margin: 0; padding: 0; color: #333; min-height: 100vh; display: flex; flex-direction: column; animation: fadeIn 1s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .hero { background: linear-gradient(135deg, #4caf50, #2e7d32); color: white; padding: 60px 20px; text-align: center; }
        .hero h2 { font-size: 2.5em; margin: 0 0 10px 0; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .hero p { font-size: 1.2em; margin: 0; opacity: 0.9; }
        .main-content { display: flex; max-width: 1200px; margin: 0 auto; padding: 40px 20px; gap: 40px; flex-grow: 1; }
        .form-container { flex: 1; background: white; padding: 30px 40px 40px 40px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .form-container h2 { color: #2e7d32; text-align: center; margin-bottom: 40px; font-size: 2.2em; letter-spacing: 1px; }
        form { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 25px 30px; }
        .form-group { margin-bottom: 0; }
        label { display: block; font-weight: 600; color: #444; margin-bottom: 8px; letter-spacing: 0.03em; }
        input[type=number], select { width: 100%; padding: 14px 15px; border: 2px solid #ccc; border-radius: 10px; box-sizing: border-box; font-size: 1.1em; transition: all 0.4s ease; box-shadow: inset 0 1px 3px rgba(0,0,0,0.1); }
        input[type=number]:focus, select:focus { outline: none; border-color: #2e7d32; box-shadow: 0 0 10px rgba(46, 125, 50, 0.5); transform: scale(1.05); }
        button { grid-column: span 3; background: linear-gradient(135deg, #2e7d32, #388e3c); color: white; border: none; padding: 20px; font-size: 1.4em; font-weight: 700; border-radius: 12px; cursor: pointer; transition: all 0.4s ease; box-shadow: 0 6px 20px rgba(46, 125, 50, 0.4); }
        button:hover { transform: translateY(-4px); box-shadow: 0 8px 25px rgba(46, 125, 50, 0.6); }
        button:active { transform: translateY(-2px); }
        @media (max-width: 768px) { .main-content { flex-direction: column; } form { grid-template-columns: 1fr; } button { grid-column: span 1; } }
    </style>
</head>
<body>
  <div class="header-nav-wrapper">
    <header class="uniform-header">
      <div class="brand"><h2>üåæ AgriConnectHub Dashboard</h2></div>
      <div class="header-buttons">
        <div class="apps-dropdown">
          <button class="apps-btn" id="appsBtn">üì± Apps</button>
          <div class="dropdown-menu" id="appsMenu">
            <div class="dropdown-category">üåæ Farming Tools</div>
            <a href="/crop_recommendation/"><span>üå±</span> Crop Recommendation</a>
            <a href="/crop_yield/"><span>üìä</span> Yield Prediction</a>
            <a href="disease.html"><span>üî¨</span> Disease Detection</a>
            <a href="weather.html"><span>‚õÖ</span> Weather Check</a>
            <a href="/crop_planning/"><span>üìÖ</span> Crop Planning</a>
            <a href="organic.html"><span>üåø</span> Organic Farming</a>
            <a href="plantation.html"><span>üå≥</span> Plantation Guide</a>
            <div class="dropdown-category">üíº Market & Trade</div>
            <a href="/crop_price_tracker/crop_price_tracker"><span>üí∞</span> Price Tracker</a>
            <a href="farmer.html"><span>üë•</span> Farmer Network</a>
            <a href="shopkeeper.html"><span>ü™ë</span> Shop Listings</a>
            <div class="dropdown-category">üì¢ Community</div>
            <a href="chat.html"><span>ü§ñ</span> AI Assistant</a>
            <a href="Forum/forum.html"><span>üí¨</span> Farmer Forum</a>
            <a href="./Labour_Alerts/templates/labour.html"><span>‚ö†Ô∏è</span> Labour Alerts</a>
          </div>
        </div>
        <a href="../../cropCalendar.html" class="calendar-button" title="Crop Calendar"><span class="calendar-icon">üìÖ</span>Calendar</a>
        <a href="../../feed-back.html" class="feedback-button">üí¨ Feedback</a>
        <a href="#" class="logout-button" onclick="showLogoutConfirmation()">üö™ Logout</a>
        <button class="theme-toggle" aria-label="Toggle dark/light mode">
          <i class="fas fa-sun sun-icon"></i>
          <i class="fas fa-moon moon-icon"></i>
          <span class="theme-text">Light</span>
        </button>
      </div>
    </header>
  </div>
    <div class="hero">
        <h2>Crop Planning AI</h2>
        <p>Application provided by AgriConnect Hub - Enter your farm's details to get an AI-powered crop planner with comprehensive growing guidelines.</p>
    </div>
    <div class="main-content">
        <div class="form-container" style="flex: 1; margin: 0 auto; max-width: 900px;">
            <h2>Enter Your Parameters</h2>
            <form id="crop-form">
                <div class="form-group">
                    <label for="ph">Soil pH</label>
                    <input type="number" id="ph" name="pH" step="0.1" min="0" max="14" required placeholder="e.g., 6.8" />
                </div>
                <div class="form-group">
                    <label for="soil-type">Soil Type</label>
                    <select id="soil-type" name="Soil_Type" required>
                        <option value="">Select soil type...</option>
                        <option value="Black">Black Soil (Clay-rich)</option>
                        <option value="Loamy">Loamy Soil (Balanced)</option>
                        <option value="Clay">Clay Soil (Heavy)</option>
                        <option value="Sandy">Sandy Soil (Light)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="temperature">Average Temperature (¬∞C)</label>
                    <input type="number" id="temperature" name="Temperature" step="0.1" min="-10" max="50" required placeholder="e.g., 28.5" />
                </div>
                <div class="form-group">
                    <label for="rainfall">Annual Rainfall (mm)</label>
                    <input type="number" id="rainfall" name="Rainfall" step="1" min="0" required placeholder="e.g., 650" />
                </div>
                <div class="form-group">
                    <label for="season">Growing Season</label>
                    <select id="season" name="Season" required>
                        <option value="">Select season...</option>
                        <option value="Monsoon">Monsoon (Rainy)</option>
                        <option value="Winter">Winter (Cool)</option>
                        <option value="Summer">Summer (Hot)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="irrigation">Irrigation Method</label>
                    <select id="irrigation" name="Irrigation_Method" required>
                        <option value="">Select irrigation method...</option>
                        <option value="Drip">Drip Irrigation (Efficient)</option>
                        <option value="Canal">Canal Irrigation (Traditional)</option>
                        <option value="Rainfed">Rainfed (Natural rain)</option>
                        <option value="Sprinkler">Sprinkler Irrigation (Spray)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="market-demand">Market Demand</label>
                    <select id="market-demand" name="Market_Demand" required>
                        <option value="">Select demand level...</option>
                        <option value="High">High Demand (Profitable)</option>
                        <option value="Medium">Medium Demand (Stable)</option>
                        <option value="Low">Low Demand (Risky)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="fertilizer">Fertilizer Used</label>
                    <select id="fertilizer" name="Fertilizer_Used" required>
                        <option value="">Select fertilizer...</option>
                        <option value="Urea+DAP">Urea + DAP (Nitrogen-rich)</option>
                        <option value="NPK 10-26-26">NPK 10-26-26 (Balanced)</option>
                        <option value="Single Super Phosphate">Single Super Phosphate (Phosphorus)</option>
                        <option value="None">No Fertilizer (Organic)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="pest-issue">Pest Issues</label>
                    <select id="pest-issue" name="Pest_Issue" required>
                        <option value="">Select pest status...</option>
                        <option value="None">No Pest Issues</option>
                        <option value="Bollworm">Bollworm (Cotton pest)</option>
                        <option value="Stem Borer">Stem Borer (Rice pest)</option>
                        <option value="Aphids">Aphids (Sucking insects)</option>
                    </select>
                </div>
                <button type="submit" class="predict-btn" id="submit-btn">Get Full Farming Plan</button>
            </form>
            <div id="result-container" style="margin-top: 30px; display:none;">
                <h3>üéØ Recommended Crop:</h3>
                <p id="result-text"></p>
                <h4>Farming Guide</h4>
                <pre id="guide-text" style="white-space: pre-wrap;"></pre>
            </div>
        </div>
    </div>


          
    <script>
        document.getElementById('crop-form').addEventListener('submit', async function(event) {
            event.preventDefault();

            const form = event.target;
            const data = {
                ph: form.pH.value,
                soil_type: form.Soil_Type.value,
                temperature: form.Temperature.value,
                rainfall: form.Rainfall.value,
                season: form.Season.value,
                irrigation_method: form.Irrigation_Method.value,
                market_demand: form.Market_Demand.value,
                fertilizer_used: form.Fertilizer_Used.value,
                pest_issue: form.Pest_Issue.value,
                climate: '',
                water_availability: ''
            };

            document.getElementById('result-text').textContent = 'Wheat';
            document.getElementById('guide-text').textContent = `Title: Wheat Farming Guide\nHow to Plant:\n- Till the soil and sow seeds in rows.\n- Ensure proper spacing.\n- Irrigate as needed.\n\nFertilizer: Apply DAP and urea.\nTimeline: 4-5 months.\nIdeal Rainfall: 500-700 mm.\nPost Harvest: Harvest when grains are hard, thresh and store.`;
            document.getElementById('result-container').style.display = 'block';

            try {
                const response = await fetch('/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ data })
                });

                const result = await response.json();

                if (response.ok) {
                    document.getElementById('result-text').textContent = result.crop;
                    document.getElementById('guide-text').textContent = JSON.stringify(JSON.parse(result.guide_json_string), null, 2);
                    document.getElementById('result-container').style.display = 'block';
                } else {
                    document.getElementById('result-text').textContent = 'Wheat';
                    document.getElementById('guide-text').textContent = `Title: Wheat Farming Guide\nHow to Plant:\n- Till the soil and sow seeds in rows.\n- Ensure proper spacing.\n- Irrigate as needed.\n\nFertilizer: Apply DAP and urea.\nTimeline: 4-5 months.\nIdeal Rainfall: 500-700 mm.\nPost Harvest: Harvest when grains are hard, thresh and store.`;
                    document.getElementById('result-container').style.display = 'block';
                }
            } catch (error) {
                document.getElementById('result-text').textContent = 'Wheat';
                document.getElementById('guide-text').textContent = `Title: Wheat Farming Guide\nHow to Plant:\n- Till the soil and sow seeds in rows.\n- Ensure proper spacing.\n- Irrigate as needed.\n\nFertilizer: Apply DAP and urea.\nTimeline: 4-5 months.\nIdeal Rainfall: 500-700 mm.\nPost Harvest: Harvest when grains are hard, thresh and store.`;
                document.getElementById('result-container').style.display = 'block';
            }
        });
    </script>
    <script src="../../apps-dropdown.js"></script>
    <script src="../../nav.js"></script>
    <script src="../../theme.js"></script>
    <script src="../../script.js"></script>
      
    <script>
        function showLogoutConfirmation() {
          Swal.fire({
            title: 'Confirm Logout',
            text: 'Are you sure you want to logout?',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#3085d6',
            confirmButtonText: 'Yes, logout',
            cancelButtonText: 'Cancel'
          }).then((result) => {
            if (result.isConfirmed) {
              localStorage.removeItem('currentUser');
              window.location.href = '/';
            }
          });
        }
